From: Philip Chimento <philip.chimento@gmail.com>
Subject: build: Include configure script, be nicer about options

A configure script is not included in the SpiderMonkey tarball by
default. Also, we have to account for JHbuild passing extra unknown
options like --disable-Werror.

https://bugzilla.mozilla.org/show_bug.cgi?id=1379540

MODIFIED by Ian Stakenvicius, to *not* attempt to overwrite the existing
js/src/configure that 'make-source-package.sh' apparently adds to the
tarball.

--- a/python/mozbuild/mozbuild/configure/__init__.py	2020-03-05 21:57:20.000000000 +0100
+++ b/python/mozbuild/mozbuild/configure/__init__.py	2020-03-14 13:39:53.575801257 +0100
@@ -470,11 +470,10 @@
         # All options should have been removed (handled) by now.
         for arg in self._helper:
             without_value = arg.split('=', 1)[0]
-            msg = 'Unknown option: %s' % without_value
+            msg = 'Ignoring unknown option: %s' % without_value
             if self._help:
                 self._logger.warning(msg)
-            else:
-                raise InvalidOptionError(msg)
+            print(msg)
 
         # Run the execution queue
         for func, args in self._execution_queue:
--- a/python/mozbuild/mozbuild/configure/options.py	2020-03-05 21:57:20.000000000 +0100
+++ b/python/mozbuild/mozbuild/configure/options.py	2020-03-14 13:41:38.143465468 +0100
@@ -437,7 +437,11 @@
 
     def add(self, arg, origin='command-line', args=None):
         assert origin != 'default'
-        prefix, name, values = Option.split_option(arg)
+        try:
+            prefix, name, values = Option.split_option(arg)
+        except InvalidOptionError as e:
+            print('Ignoring', arg, ':', e)
+            return
         if args is None:
             args = self._extra_args
         if args is self._extra_args and name in self._extra_args:
